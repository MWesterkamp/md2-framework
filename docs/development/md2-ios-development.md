Developing MD2 for iOS
======================

This page gathers information relevant when developing the iOS generators that generate iOS apps.

iOS apps generated by MD2 consist of two parts: a static (generic) library (part of the target platform in MDSD terminology) and the dynamically generated parts that implement the functionality described in models.
The library is always copied as-is to the generated Xcode project.

In general, a development workflow similar to the following is advisable for the iOS generators, at least in case of larger changes: Modify a generated app to include the desired modifications, essentially utilizing it as a reference implementation. After you are confident about the modifications, adapt the framework, i.e., the iOS generators and the static library as necessary.

The next section gives some hints on how to directly work on the static library contained in the framework repository when using this or a similar workflow (instead of modifying the copied version embedded in a generated app).
The second section explains how to easily regenerate the zip file of the library shipped with the framework. This is necessary for the generated apps to use the latest version of the library, as this zip file will be extracted during code generation.

Referencing the Md2Library from the repository
----------------------------------------------

Each generated app contains its own copy of the Md2Library. When modifying such a generated apps serving as a reference implementation (as described above), it is often helpful to directly work on the Md2Library folder contained in the framework repository.
This is possible by replacing the reference to the copied library project with a reference to the framework project:

1. Open the generated app in Xcode.
2. Ensure that the project file of the generated app is not opened in Xcode (close it via File > Close "NameOfApp.xcodeproj").
3. Open the project file Md2Library.xcodeproj that is a child element of the generated app.
4. In the File Inspector (usually in the right column), click on the icon behind the location path (see screenshot; if it is greyed out, the project file of the whole app is likely opened - see step 2).
	![Screenshot of project file in Xcode](change-library-location.png)
5. In the "Choose project file and location" dialog that appears, navigate to your clone of the MD2 repository and select the `Md2Library.xcodeproj` file in the folder `Md2Library`.
6. Now open the top-level project file of the generated app, switch to the "Build Phases" tab, and add `libMd2Library.a` to the list of "Linked Frameworks and Libraries" (using the "plus" icon).

*Done*. Changes to the library will now directly be made in the MD2 repository. To include them in the generators (MD2 Eclipse plugin), see the next section.
Unfortunately, resources such as images still point to the copied versions.

Creating the zip file of the library
------------------------------------

The generator plugins always extract the library from the zip file `res/resources/ios/Md2Library.zip` in the main framework project. Hence, this zip file needs to be regenerated after changes to the library. For this purpose, the Md2Library folder contains an ant buildfile build.xml.
If you have imported the Md2Library as a project in Eclipse, you can select the file and run it as an "Ant Build". Afterwards, you have to refresh the zip file in Eclipse â€“ otherwise, Eclipse will not notice the change.

To automate the last step, you can modify the run configuration of the ant build: Select "External Tools Configuration..." (for example, from Run > External Tools), select the node representing the ant build file of the iOS library, and, on the tab "Refresh", make sure that Eclipse refreshes the zip file `Md2Library.zip` after completing the ant build (e.g., choose "Specific resource" and specify that file).